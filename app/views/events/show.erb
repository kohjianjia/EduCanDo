<div class="container" style="margin-top: 2%;">

	<div class="mt-3">
		<h4>
			<%= @event.title %> by <%= @event.user.first_name %> <%= @event.user.last_name %>
			<% if @event.user_id == current_user.id %>
				<% if @event.longitude == nil && @event.latitude == nil %>
					<%= link_to 'Mark location', update_location_path(@event), :id => "mark_location", :class => "btn btn-warning ml-2" %>
				<% end %>
			<% end %>
		</h4>
	</div>

	<div class="mt-3">
		<h5 class="text-capitalize">Category: <%= @event.category %></h5>
	</div>

	<div class="mt-3">
		<h5 class="text-capitalize">Venue: <%= @event.venue %></h5>
	</div>

	<div class="mt-3">
		<h5>Time: <%= @event.start_time %> to <%= @event.end_time %></h5>
	</div>

	<div class="mt-3">
		<h5>Date: <%= @event.event_date %></h5>
	</div>

	<div class="mt-3">
		<h5>Description:</h5>
		<p><%= @event.description %></p>
	</div>

	<%= link_to 'All Events', events_path, :class => "btn btn-info" %>

	<% if current_user != nil %>
		<% if @event.user_id == current_user.id %>
			<%= link_to 'Update', edit_event_path, :class => "btn btn-info" %>
			<%= link_to 'Delete', event_path(@event), :class => "btn btn-danger", method: :delete, data: {confirm: 'Are you sure you want to delete this event?'} %>
		<% end %>
	<% end %>

	<% if signed_in? %>
		<% if @event.user_id != current_user.id %>
			<%= link_to 'Click to Attend', new_event_attendance_path(@event), :id => "mark_attendance", :class => "btn btn-success" %>
		<% end %>
	<% else %>
		<h5>To join an event, please sign in.</h5>
	<% end %>
</div>


<% if @event.user_id == current_user.id %>

    <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      $('#mark_location').hide();

      var pos = ""
      var map, infoWindow;

      function initMap() {
        //map = new google.maps.Map(document.getElementById('map'), {
          //center: {lat: -34.397, lng: 150.644},
         // zoom: 20
        //});
       // infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              authenticity_token: AUTH_TOKEN,
            };

	        $('#mark_location').show();
            console.log(pos)
			$('#mark_location').on('click', function(e){
				e.preventDefault();
				console.log(this)

				$.ajax({
					url: '/events/<%= @event.id %>/update_loc',
					method: "POST",
					data: pos,
					dataType: 'json',
					success: function(data){
					  // refactor here (insert message instead of flash in events_controller)
					  location.reload();
					}
				});
			})

            //longitude and latitude
            // console.log(pos)
      
            // infoWindow.open(map);
            // map.setCenter(pos);
            // var marker = new google.maps.Marker({position: pos, map: map});

            // Add circle overlay and bind to marker
			// var circle = new google.maps.Circle({
			//   map: map,
			//   radius: 35,    // 10 miles in metres
			//   fillColor: '#AA0000'
			// });
			// circle.bindTo('center', marker, 'position');

          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['YOUR_API_KEY'] %>&callback=initMap">
    </script>

<% else %>

<!-- add location for attendee -->


    <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      $('#mark_attendance').hide();

      var pos = ""
      var map, infoWindow;

      function initMap() {
        //map = new google.maps.Map(document.getElementById('map'), {
          //center: {lat: -34.397, lng: 150.644},
         // zoom: 20
        //});
       // infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              authenticity_token: AUTH_TOKEN,
            };

            //longitude and latitude
            console.log(pos)

            $('#mark_attendance').show();
      
            // infoWindow.open(map);
            // map.setCenter(pos);
            // var marker = new google.maps.Marker({position: pos, map: map});

            // Add circle overlay and bind to marker
			// var circle = new google.maps.Circle({
			//   map: map,
			//   radius: 35,    // 10 miles in metres
			//   fillColor: '#AA0000'
			// });
			// circle.bindTo('center', marker, 'position');

          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['YOUR_API_KEY'] %>&callback=initMap">
    </script>


<% end %>

